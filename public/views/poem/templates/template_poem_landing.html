<div ng-include="model.templates.navHeader"></div>

<div class="container-fluid">
    <div class="alert-danger" ng-show="model.errorMsg">{{model.errorMsg}}</div>
    <div class="alert-success" ng-show="model.successMsg">{{model.successMsg}}</div>

    <div class="col-xs-12 col-sm-6">
        <div ng-include="model.templates.poem"></div>
    </div>

    <div ng-if="model.poemEditFlag && model.poem._id" class="col-xs-12 col-sm-6">
        <div ng-if="model.reviews.length">
            <label>Reviews</label>
            <ul class="list-group aoa-list-group">
                <li class="list-group-item" ng-repeat="review in model.reviews">
                    <a href="#!/profile/{{review.reviewer._id}}">
                        <i>{{review.reviewer.username}}</i>
                    </a>
                    <br/>
                    <p ng-if="review.text">{{review.text}}</p>
                    <i ng-if="!review.text">Review Pending...</i>
                </li>
            </ul>
            <br/>
        </div>

        <label>Request a Review:</label>
        <!-- TODO need generic user list template to use here and in profile -->
        <ul class="list-group aoa-list-group">
            <li class="list-group-item" ng-repeat="follower in model.followers">
                <div class="container-fluid aoa-padding-lr-none">
                    <a href="#!/profile/{{follower._id}}">{{follower.username}}</a>
                    <a class="btn btn-warning pull-right" ng-click="model.requestReview(follower._id)">Request
                        Review</a>
                </div>
            </li>
        </ul>
    </div>

    <div ng-if="model.poem._id" class="col-xs-12">
        <label>Translations</label>
        <!-- TODO bring out into separate template -->
        <ul class="list-group aoa-list-group">
            <li class="list-group-item" ng-repeat="translation in model.translations">
                <div>
                    <a href="#!/poem/{{model.poem._id}}/translation/{{translation._id}}">
                        <b>{{translation.title || "NO TITLE"}}</b>
                    </a>
                </div>
                <i>{{translation.author.username}}</i>
                <div ng-repeat="line in translation.lines | limitTo: model.maxLines track by $index">{{line}}</div>
                <span ng-if="translation.lines.length > model.maxLines">...</span>
            </li>
        </ul>
    </div>

    <!--<a ng-if="model.poem._id"-->
       <!--class="btn btn-success btn-block"-->
       <!--ng-click="model.addTranslation()">Add Translation</a>-->
    <!--&lt;!&ndash; TODO what happens when poem with translations is deleted? &ndash;&gt;-->
    <!--<a ng-if="model.poemEditFlag" class="btn btn-danger btn-block" ng-click="model.deletePoem()">Delete Poem</a>-->
</div>

<div ng-include="model.templates.navFooter"></div>